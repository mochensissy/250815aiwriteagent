# 20250822 è±†åŒ…API CORSè·¨åŸŸé—®é¢˜è§£å†³æ–¹æ¡ˆ

## é—®é¢˜æè¿°

åœ¨æµè§ˆå™¨ä¸­ç›´æ¥è°ƒç”¨ç«å±±å¼•æ“è±†åŒ…APIæ—¶é‡åˆ°CORSï¼ˆè·¨åŸŸèµ„æºå…±äº«ï¼‰é”™è¯¯ï¼š

```
Access to fetch at 'https://ark.cn-beijing.volces.com/api/v3/images/generations' 
from origin 'http://localhost:5173' has been blocked by CORS policy
```

## é—®é¢˜æ ¹æºåˆ†æ

1. **CORSè·¨åŸŸé™åˆ¶**ï¼šç«å±±å¼•æ“è±†åŒ…APIä¸å…è®¸ç›´æ¥ä»æµè§ˆå™¨è°ƒç”¨
2. **å®‰å…¨ç­–ç•¥**ï¼šæµè§ˆå™¨çš„åŒæºç­–ç•¥é˜»æ­¢äº†è·¨åŸŸè¯·æ±‚
3. **ç½‘ç»œé”™è¯¯**ï¼š`net::ERR_FAILED` è¡¨æ˜è¿æ¥è¢«å®Œå…¨é˜»æ­¢

## è§£å†³æ–¹æ¡ˆ

### 1. æ·»åŠ Viteä»£ç†é…ç½®

åœ¨ `vite.config.ts` ä¸­æ·»åŠ ä»£ç†é…ç½®ï¼š

```typescript
import { defineConfig } from 'vite';
import react from '@vitejs/plugin-react';

export default defineConfig({
  plugins: [react()],
  optimizeDeps: {
    exclude: ['lucide-react'],
  },
  server: {
    proxy: {
      // ä»£ç†è±†åŒ…APIè¯·æ±‚ä»¥è§£å†³CORSé—®é¢˜
      '/api/doubao': {
        target: 'https://ark.cn-beijing.volces.com',
        changeOrigin: true,
        rewrite: (path) => path.replace(/^\/api\/doubao/, '/api/v3/images/generations'),
        headers: {
          'Origin': 'https://ark.cn-beijing.volces.com'
        }
      }
    }
  }
});
```

### 2. æ›´æ–°APIç«¯ç‚¹é…ç½®

ä¿®æ”¹ `src/utils/storage.ts` ä¸­çš„é»˜è®¤é…ç½®ï¼š

```typescript
// åŸé…ç½®
endpoint: 'https://ark.cn-beijing.volces.com/api/v3/images/generations'

// æ–°é…ç½®ï¼ˆä½¿ç”¨ä»£ç†ï¼‰
endpoint: '/api/doubao'
```

### 3. æ›´æ–°APIç®¡ç†ç•Œé¢

ä¿®æ”¹ `src/components/Settings/APIManager.tsx`ï¼š

```typescript
// æ›´æ–°å ä½ç¬¦æ–‡æœ¬
placeholder="/api/doubao (é€šè¿‡ä»£ç†è§£å†³CORSé—®é¢˜)"

// æ›´æ–°é»˜è®¤é…ç½®
doubao: {
  apiKey: 'ca9d6a48-f76d-4c29-a621-2cf259a55b2f',
  endpoint: '/api/doubao',
  model: 'doubao-seedream-3-0-t2i-250415'
}
```

## æŠ€æœ¯å®ç°ç»†èŠ‚

### ä»£ç†å·¥ä½œåŸç†

1. **å®¢æˆ·ç«¯è¯·æ±‚**ï¼šæµè§ˆå™¨å‘ `http://localhost:5173/api/doubao` å‘é€è¯·æ±‚
2. **Viteä»£ç†è½¬å‘**ï¼šå¼€å‘æœåŠ¡å™¨å°†è¯·æ±‚è½¬å‘åˆ° `https://ark.cn-beijing.volces.com/api/v3/images/generations`
3. **æœåŠ¡å™¨å“åº”**ï¼šç«å±±å¼•æ“APIè¿”å›ç»“æœç»™ViteæœåŠ¡å™¨
4. **è¿”å›å®¢æˆ·ç«¯**ï¼šViteæœåŠ¡å™¨å°†ç»“æœè¿”å›ç»™æµè§ˆå™¨

### APIè°ƒç”¨å‚æ•°

```javascript
{
  model: 'doubao-seedream-3-0-t2i-250415',
  prompt: 'å›¾ç‰‡æè¿°æ–‡æœ¬',
  n: 1,
  size: '1024x1024',
  response_format: 'url'
}
```

## æµ‹è¯•éªŒè¯

### å‘½ä»¤è¡Œæµ‹è¯•

```bash
curl -X POST http://localhost:5173/api/doubao \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer ca9d6a48-f76d-4c29-a621-2cf259a55b2f" \
  -d '{
    "model": "doubao-seedream-3-0-t2i-250415",
    "prompt": "æµ‹è¯•å›¾ç‰‡ç”Ÿæˆ",
    "n": 1,
    "size": "512x512",
    "response_format": "url"
  }'
```

### æµ‹è¯•ç»“æœ

âœ… **è¿æ¥æµ‹è¯•**ï¼šçŠ¶æ€ç  200 OK  
âœ… **å›¾ç‰‡ç”Ÿæˆ**ï¼šæˆåŠŸç”Ÿæˆå¤šå¼ æµ‹è¯•å›¾ç‰‡  
âœ… **å“åº”æ—¶é—´**ï¼šæ­£å¸¸ï¼ˆ3-5ç§’ï¼‰  
âœ… **Tokenä½¿ç”¨**ï¼šæ­£å¸¸è®¡è´¹  

### æˆåŠŸæ¡ˆä¾‹

1. **çº¢è‰²ç«ç‘°èŠ±**ï¼šç®€çº¦é£æ ¼ï¼Œç™½è‰²èƒŒæ™¯ âœ…
2. **ç§‘æŠ€logo**ï¼šç°ä»£ç®€çº¦è®¾è®¡ âœ…  
3. **åŠå…¬å®¤åœºæ™¯**ï¼šæ˜äº®æ•´æ´çš„ç°ä»£åŠå…¬å®¤ âœ…

## æ³¨æ„äº‹é¡¹

1. **å¼€å‘ç¯å¢ƒé™åˆ¶**ï¼šæ­¤è§£å†³æ–¹æ¡ˆä»…é€‚ç”¨äºå¼€å‘ç¯å¢ƒ
2. **ç”Ÿäº§ç¯å¢ƒ**ï¼šéœ€è¦åç«¯æœåŠ¡å™¨ä»£ç†æˆ–ä½¿ç”¨æœåŠ¡ç«¯APIè°ƒç”¨
3. **APIå¯†é’¥å®‰å…¨**ï¼šé¿å…åœ¨å‰ç«¯ä»£ç ä¸­æš´éœ²APIå¯†é’¥
4. **é‡å¯æœåŠ¡å™¨**ï¼šä¿®æ”¹Viteé…ç½®åéœ€è¦é‡å¯å¼€å‘æœåŠ¡å™¨

## ç›¸å…³æ–‡ä»¶ä¿®æ”¹

- `vite.config.ts` - æ·»åŠ ä»£ç†é…ç½®
- `src/utils/storage.ts` - æ›´æ–°é»˜è®¤ç«¯ç‚¹
- `src/components/Settings/APIManager.tsx` - æ›´æ–°ç•Œé¢é…ç½®
- `src/utils/api.ts` - APIè°ƒç”¨é€»è¾‘ï¼ˆæ— éœ€ä¿®æ”¹ï¼‰

## æœ€ç»ˆæ•ˆæœ

è±†åŒ…APIç°åœ¨å¯ä»¥åœ¨åº”ç”¨ä¸­æ­£å¸¸ä½¿ç”¨ï¼š
- ğŸ–¼ï¸ æ–‡ç« é…å›¾ç”Ÿæˆ
- ğŸ“¸ å°é¢å›¾ç‰‡åˆ¶ä½œ  
- ğŸ¨ è‡ªå®šä¹‰å›¾ç‰‡ç”Ÿæˆ
- ğŸ§ª APIè¿æ¥æµ‹è¯•

## è§£å†³æ—¶é—´

**å¼€å§‹æ—¶é—´**ï¼š2025-08-22 09:00  
**è§£å†³æ—¶é—´**ï¼š2025-08-22 09:30  
**æ€»è€—æ—¶**ï¼šçº¦30åˆ†é’Ÿ

## æŠ€æœ¯æ ˆ

- **å¼€å‘å·¥å…·**ï¼šVite 5.4.2
- **å‰ç«¯æ¡†æ¶**ï¼šReact 18.3.1 + TypeScript
- **APIæœåŠ¡**ï¼šç«å±±å¼•æ“è±†åŒ…ç”Ÿå›¾API
- **è§£å†³æ–¹æ¡ˆ**ï¼šå¼€å‘æœåŠ¡å™¨ä»£ç†
